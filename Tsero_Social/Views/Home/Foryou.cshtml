@{
    Layout = null;
    IgnoreBody();
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - For You</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/PostCards.css" asp-append-version="true" />
    <link rel="icon" type="image/x-icon" href="../img/Tlogo.jpg">
</head>
<body>
    <div class= "fixedelemt"></div>
    <header class= "navigatorrs">   
    <nav class= "navigatorrs2 ">
        <div class="container_fluidd">
            <a class="Tsero_Social" asp-area="" asp-controller="Home" asp-action="Foryou">Tsero_Sociall</a>
            <div class="navbarLIn">
                <div class="navbarLinks">
                    <div class="nav-item">
                        <a class="nav-links" asp-area="" asp-controller="Home" asp-action="Foryou"><img src="../img/smartphone.png" class="NavImgs"/> For You</a>
                    </div>
                    <div class="nav-item">
                        <a class="nav-links" asp-area="" asp-controller="MyProfile" asp-action="Profile"><img src="../img/ProfileBackground.png"class="NavImgs"/> Profile</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>       

  <button class= "BurgerButton" id = "BurgerButton" onclick="BurgerMenuShow()">
    <div class= "SpanLines Line1"></div>
    <div class= "SpanLines Line2"></div>
    <div class= "SpanLines Line3"></div>
  </button>
</header>
<header class= "HeaderBurgerContainer" id = "HeaderBurgerContainer">
    <div class = "HeaderBurger" id = "HeaderBurger">
        <div class= "BurgerXbuttonAlign">
          <div class= "BurgerButton"  id = "BurgerButton2">
            <img src ="../img/WhiteX.png" width - "40px"/>
         </div>
        </div>
       <div class= "NavBurgerAlign">
          <div class="nav-item NavBurger">
             <a class="BurgerNavLinks" asp-area="" asp-controller="Home" asp-action="Foryou"><img src="../img/smartphone.png" class="NavImgsBurger"/> For You</a>
          </div>
         <div class="nav-item NavBurger">
             <a class="BurgerNavLinks" asp-area="" asp-controller="MyProfile" asp-action="Profile"><img src="../img/ProfileBackground.png"class="NavImgsBurger"/> Profile</a>
         </div>
       </div>
    </div>
</header>

    <!--For You Page-->
    @if (ViewBag.UserPosts != null)
    {
    <div class="homepage">
 <section class="foryoupage">
      <div class="MyPosts"  data-page="1" id = "MyPosts">
                    @foreach (var post in Model)
                    {
                        string username = "";
                        string profilepicture = "";
                        var postsList = ViewBag.Posts as List<User>;
                        string comment = "";
                        string comenterUserName = "";
                        string ComenterProfilePicture = "";
                        List<Comments> commentslist = new List<Comments>();
                        var users = ViewBag.Users as List<User>;
                        var comments = ViewBag.Comments as List<Comments>;
                        var Likes = ViewBag.Likes as List<Likes>;
                        var Follows = ViewBag.Follows as List<Follow>;
                        var comcount = comments != null ? comments.Where(u => u.PostID == post.Id).Count() : 0;
                        var LikeCount = Likes != null ? Likes.Where(u => u.PostID == post.Id).Count() : 0;
                        var PostAuthor = users.FirstOrDefault(u => u.id == post.UserID);
                        string output = "";
                        int CurrentUserID = 0;
                        if (ViewBag.CurrentUser != null)
                        {
                            foreach (var item in ViewBag.CurrentUser)
                            {
                                CurrentUserID = item.id;
                            }
                        }
                        @if (LikeCount > 0)
                        {
                            output += LikeCount;
                        }
                        else if (LikeCount < 0)
                        {
                            output = "";
                        }
                        @if (comments != null)
                        {
                            var com = comments.Where(c => c.PostID == post.Id);
                            if (com != null)
                            {
                                foreach (var item in com)
                                {
                                    commentslist.Add(item);
                                }
                            }
                        }
                          <div class="Each_Post" id = "Each_Post">
                              <div class = "FollowToPerson">
                              <!--Follow person-->
                                @{

                                    string Follow = "";
                                    var if_following = Follows.FirstOrDefault(u => u.FollowerID == @CurrentUserID && u.FollowingID == PostAuthor.id);
                                    if (if_following !=null)
                                    {
                                        Follow = "Following";
                                    }
                                    else if(if_following == null)
                                    {
                                        Follow = "Follow";
                                    }
                                }
                                @if (post.UserID != CurrentUserID)
                                {
                                    <div id = "NOnExistent"></div>
                                   <form class="FormFollow" method="post" asp-action="FollowPerson">
                                         <input type="hidden"  name="FollowingID" value=" @PostAuthor.id"/>
                                         <input type="hidden"  name="FollowerID" value="@CurrentUserID" />
                                         <button class= "Follow" Id = "Follow" >@Follow</button>                             
                                           <script>
                                                $('#NOnExistent').load("/Home/_FollowResult")
                                           </script>                               
                                   </form>
                                }
                              <!--Follow person-->
                              </div>

                          <form class="FormFollow" method="post" asp-action="UserProfileGenerate" asp-controller="UserProfile">
                             <input type="hidden"  name="UserID" value=" @PostAuthor.id"/>                      
                          <button class="userdata">
                              <div class= "namephotoflex">
                                  <div class = "postDateParent"> 
                                  @{ if (postsList != null)
                                   {
                                       var user = postsList.FirstOrDefault(u => u.id == post.UserID);
                                       if (user != null)
                                       {
                                           if (user.ProfilePicture != "")
                                           {
                                               profilepicture = user.ProfilePicture;
                                               <img class="PostProfile" src="@profilepicture" alt="">
                                           }
                                           else if(user.ProfilePicture == null)
                                           {
                                               <img class="PostProfile" src="../img/ProfileBackground.png" alt="">
                                           }
                                           username = user.Username;
                                        }
                                      }
                                   }
                                      
                                  </div>                   
                                  <div class= "UpdateProfile">
                                    <div class = "UpdateTextAndNameFlex">
                                     <h2 class= "MyUsername">@username</h2>
                                     @if (post.PostType == 1)
                                     {
                                      <p class= "UpdatedText">-Updated Their Profile Picture </p>
                                     }                                      
                                   </div>
                                   <div>
                                       @{
                                           DateTime dbDateTime = post.DateTime;
                                           DateTime currentDateTime = DateTime.Now;
                                           TimeSpan timeDifference = currentDateTime - dbDateTime;
                                      
                                           int totalMinutes = (int)timeDifference.TotalMinutes;
                                           int totalHours = (int)timeDifference.TotalHours;
                                           int totalDays = (int)timeDifference.TotalDays;
                                      
                                           if (totalMinutes < 60)
                                           {                                           
                                               <p class="datetimetracking">@totalMinutes minutes ago</p>
                                           }
                                           else if (totalHours < 24)
                                           {
                                               int remainingMinutes = totalMinutes % 60;
                                               <p class="datetimetracking">@totalHours hours and @remainingMinutes minutes ago</p>
                                           }
                                           else
                                           {
                                               int remainingHours = totalHours % 24;
                                                    <p class="datetimetracking">@totalDays days, @remainingHours hours ago</p>
                                                }
                                            }
                                        </div>
                                    </div>                                 
                                </div>
                          </button>
                       </form>

                          <div class= "Postcontent">
                              <div class="flextitles"> 
                                 <p class= "flexPText">@post.post</p>
                              </div>
                              <div class= "photocontentwitdth">
                               @if (@post.Photo != null)
                               {
                               
                                  if (post.PostType == 1)
                                  {
                                     <div class="imgofpost2" id="imgofpost">
                                         <img src="@post.Photo" class="Post_photowidth2" id="Post_photowidth" alt="Post Image">    
                                     </div>
                                  }
                                  else  if (post.PostType == 2)
                                  {
                                     <div class="imgofpost" id="imgofpost">
                                          <video src="@post.Photo" class="Post_photowidth" id="Post_photowidth" alt="Post Video" autoplay muted controls></video>
                                     </div>
                                  }
                                  else
                                  {
                                    <div class="imgofpost" id="imgofpost">
                                        <img src="@post.Photo" class="Post_photowidth" id="Post_photowidth" alt="Post Image">    
                                    </div>
                                  }
                                }
                                else
                                {

                                }
                              </div>


                           <div class = "comment_likes">
                            @if (ViewBag.CurrentUser != null)
                             {
                                        string Like = "Like";
                                        string YouAnd = "By You And";
                                        string Others = "Others";
                                        int Likecount = 0;
                                        @foreach(var like in Likes)
                                        {
                                            var LikeCountQuery = Likes.Where(u => u.PostID == @post.Id).Count();
                                            var ifLiked = Likes.FirstOrDefault(u => u.UserID == @CurrentUserID && u.PostID == @post.Id);
                                            if (ifLiked != null)
                                            {
                                                Like = "❤️";
                                                Likecount = LikeCountQuery;
                                            }
                                            else
                                            {
                                                Like = "🤍";
                                                Likecount = LikeCountQuery;
                                            }
                                          
                                            
                                        }
                                        <form class="Formdelete" method="post" asp-action="Like">
                                          <input type="hidden" class="LikeTosend" name="Postid" value="@post.Id" />
                                          <input type="hidden" class="PostTodeltte" name="CurrentUserID" value="@CurrentUserID"/>
                                          <button class= "Like" Id = "Like" >@Like @Likecount</button>
                                        </form>
                                }

                               <div class= "comclick">Comment @comcount</div>
                           </div>

                  <div class = "commentSection">
                      @if (users != null)
                      {
                          var usercoment = comments.Where(u => u.PostID == post.Id);
                          if (usercoment != null)
                          {
                              foreach (var item in usercoment)
                              {
                                  var userData = users.Where(u => u.id == item.UserID);
                               <div class = "eachcomment">
                                      @foreach (var user in userData)
                                      {                      
                                       <div class = "commenterProfile">
                                         <img class="profilepic" src="@user.ProfilePicture" alt="">
                                         <b> @user.Username</b>
                                       </div>
                                      }
                                  <p>@item.Comment</p>
                                  </div>
                              }
                          }
                          else
                          {

                          }
                     }
                      </div>   
                         
                        </div>
                     </div>                         
                    }
                }
                
      </section>
    </div>
    }
   <script src="../js/Likes.js"></script>
   <script src="../js/Follow.js"></script>
   <script src="../js/site.js"></script>
</body>
</html>